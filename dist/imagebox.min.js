!function(i){function t(t,n){if(0>t||t>=B.length)return!1;c(),j=P=!0,K=B[t],O=K.index,E.src=K.url,i(L).html(K.title),i(A).html((B.length>1&&N.lang.counter||"").replace(/{x}/,K.index+1+"").replace(/{y}/,B.length+""));var e={top:(n?-(i(p).innerHeight()/2-n.y):0)+"px",left:(n?-(i(p).innerWidth()/2-n.x):0)+"px"},a={top:"0px",left:"0px"};i(f).css(e),i([p,h]).toggleClass("visible",!0),i(p).toggleClass("animating",!0),i(w).toggleClass("visible",!1);var o=f.animate([e,a],N.animation);return o.addEventListener("finish",function(){i(f).css(a)}),Q.push(o),!1}function n(t){i(I).html(N.lang.close),i([h,T]).attr("title",N.lang.close),i(C).attr("title",N.lang.prev),i(y).attr("title",N.lang.next),i(f).css("padding",N.padding),i(b).toggleClass("loading",!0),i(b).css("background-image",""),i(x).css("opacity",0),i(f).css("max-width",g(t?t.width:N.initialSize,t?t.height:N.initialSize,!1).width+2*N.padding),i([C,y]).hide(),i(document).on("keydown",d)}function e(){if(!j)return!1;var n=r(),e=l();n>=0?(i(C).show(),H.src=B[n].url):i(C).hide(),e>=0?(i(y).show(),z.src=B[e].url):i(y).hide(),i(x).css({"background-image":"url('"+E.src+"')",opacity:0}),i(p).css({top:S.scrollTop(),left:S.scrollLeft()});var a=x.animate([{opacity:0},{opacity:1}],N.animation);return a.addEventListener("finish",function(){i(x).css("opacity",1),i(b).toggleClass("loading",!1),i(b).css("background-image","url('"+E.src+"')")}),Q.push(a),u(g(E.width,E.height,!0).width,function(){var n=w.animate([{"max-height":"0px"},{"max-height":"200px"}],N.animation);n.addEventListener("finish",function(){i(w).toggleClass("visible",!0),O!=K.index&&0>W?t(O):(P=!1,i(p).toggleClass("animating",!1))}),Q.push(n)}),!1}function a(){return O=r(),0>O&&(O=0),s(),!1}function o(){return O=l(),0>O&&(O=B.length-1),s(),!1}function s(){clearTimeout(W),W=setTimeout(function(){W=-1,P||O==K.index||t(O)},N.doubleClickTimeout)}function r(){return(O||(N.loop?B.length:0))-1}function l(){return(O+1)%B.length||(N.loop?0:-1)}function d(t){var n=t.which;return i.inArray(n,N.closeKeys)>=0?i.ibClose():i.inArray(n,N.nextKeys)>=0?o():i.inArray(n,N.prevKeys)>=0?a():!0}function c(){j=!1,E.src=H.src=z.src="";for(var i=0;i<Q.length;i++)Q[i].cancel();Q=[]}function g(t,n,e){var a=t,o=n;t+2*N.padding>i(p).innerWidth()&&(t=i(p).innerWidth()-2*N.padding),n=o*t/a,n+2*N.padding>i(p).innerHeight()&&(n=i(p).innerHeight()-2*N.padding),t=n*a/o;var s=100*n/t,r={"padding-bottom":s+"%"};if(e){var l={"padding-bottom":i(m).css("padding-bottom")},d=m.animate([l,r],N.animation);d.addEventListener("finish",function(){i(m).css(r)}),Q.push(d)}else i(m).css(r);return{width:t,height:n}}function u(t,n,e){if(void 0===e&&(e=!0),t+=2*N.padding,e){var a=f.animate([{"max-width":i(f).css("max-width")},{"max-width":t+"px"}],N.animation);a.addEventListener("finish",function(){i(f).css("max-width",t),"function"==typeof n&&n()}),Q.push(a)}else i(f).css("max-width",t)}var h,p,f,v,m,b,x,C,y,w,k,T,A,L,I,K,W,E=new Image,H=new Image,z=new Image,B=[],S=i(window),N={},P=!1,j=!1,O=-1,Q=[],R={initialSize:200,lang:{close:"Close",prev:"Previous",next:"Next",counter:"Image {x} of {y}"},padding:30,closeKeys:[27,88,67],prevKeys:[37,80],nextKeys:[39,78],loop:!1,doubleClickTimeout:200,animation:{duration:600,iterations:1,delay:0,easing:"ease-in-out"}};i.fn.imagebox=function(t,n,e){n=n||function(i,t){var n={url:i.getAttribute("href")||void 0,title:i.getAttribute("title")||void 0,index:t};return n},e=e||function(i,t){return!0};var a=this;return a.unbind("click").click(function(o){for(var s=this,r=0,l=[],d=i(i(this).find(i(this).attr("data-target"))[0]||this),c=0;c<a.length;c++)e.call(s,a[c],c)&&a[c]==s&&(r=c),l.push(n(a[c],c));d.toggleClass("ib-line-fix",!0);var g={x:d.offset().left-S.scrollLeft()+d.innerWidth()/2,y:d.offset().top-S.scrollTop()+d.innerHeight()/2,width:d.innerWidth(),height:d.innerHeight()};return d.toggleClass("ib-line-fix",!1),i.imagebox(l,r,t,g)})},i.imagebox=function(e,a,o,s){return i.extend(N,R,o),B=e,n(s),t(a,s),!1},i.ibClose=function(){return c(),i([p,w,h]).toggleClass("visible",!1),i(p).toggleClass("animating",!1),K&&(K=void 0),i(document).off("keydown",d),!1},i("body").append(i([h=i('<div id="ibOverlay" />').click(i.ibClose)[0],p=i('<div id="ibWrap" />')[0]])),f=i('<div id="ibCenter" />').appendTo(p)[0],v=i('<div id="ibContent" />').appendTo(f).append([m=i('<div id="ibResponsive" />').append([b=i('<div id="ibBgImage" />')[0],x=i('<div id="ibImage" />')[0],C=i('<div id="ibPrev"><i class="ib-icon-prev"></i></div>').on("click",a)[0],y=i('<div id="ibNext"><i class="ib-icon-next"></i></div>').on("click",o)[0]])[0],w=i('<div id="ibBottomContainer" />')[0]])[0],k=i('<div id="ibBottom" />').appendTo(w).append([T=i('<a id="ibCloseLink" href="#" ><span id="ibCloseText"></span><i class="ib-icon-close"></i></a>').click(i.ibClose)[0],A=i('<small id="ibCounter" />')[0],L=i('<strong id="ibCaption" />')[0]])[0],I=i(k).find("#ibCloseText")[0],i(E).on("load",e),S.on("resize",function(){K&&u(g(E.width,E.height,!1).width,null,!1)}),i("a[rel^='lightbox']").imagebox({},null,function(i){return this==i||this.getAttribute("rel").length>8&&this.getAttribute("rel")==i.getAttribute("rel")})}(jQuery);